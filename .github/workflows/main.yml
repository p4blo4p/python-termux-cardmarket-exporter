
name: Cardmarket Export
on:
  schedule:
    - cron: '0 0 * * 0' # Weekly on Sundays
  workflow_dispatch:
    inputs:
      start_date:
        description: 'Start Date (YYYY-MM-DD)'
        required: false
      end_date:
        description: 'End Date (YYYY-MM-DD)'
        required: false
      year:
        description: 'Specific Year (e.g. 2025)'
        required: false

jobs:
  export:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: Set up Python
        uses: actions/setup-python@v4
        with:
          python-version: '3.10'

      - name: Install dependencies
        run: |
          pip install playwright pandas
          playwright install chromium

      - name: Run Export Script
        env:
          CM_USERNAME: ${{ secrets.CM_USERNAME }}
          CM_PASSWORD: ${{ secrets.CM_PASSWORD }}
        run: |
          python export_script.py \
            ${{ github.event.inputs.start_date && format('--start-date {0}', github.event.inputs.start_date) || '' }} \
            ${{ github.event.inputs.end_date && format('--end-date {0}', github.event.inputs.end_date) || '' }} \
            ${{ github.event.inputs.year && format('--year {0}', github.event.inputs.year) || '' }}

      - name: Upload Results
        uses: actions/upload-artifact@v4
        with:
          name: cardmarket-csv-export
          path: cardmarket_export.csv
